diff -Nurp linux-2.6.22-200/kernel/vserver/sched.c linux-2.6.22-210/kernel/vserver/sched.c
--- linux-2.6.22-200/kernel/vserver/sched.c	2008-03-31 17:57:47.000000000 -0400
+++ linux-2.6.22-210/kernel/vserver/sched.c	2008-03-31 18:22:46.000000000 -0400
@@ -91,7 +91,7 @@ int vx_tokens_recalc(struct _vx_sched_pc
 		vxd_check_range(delta_min[0], 0, sched_pc->interval[0]);
 #endif
 		/* advance time */
-		sched_pc->norm_time += delta;
+		sched_pc->norm_time += integral;
 
 		/* add tokens */
 		sched_pc->tokens += tokens;
@@ -161,10 +161,12 @@ on_hold:
 	/* next interval? */
 	if (!sched_pc->fill_rate[0])
 		delta_min[0] = HZ;
-	else if (tokens > sched_pc->fill_rate[0])
-		delta_min[0] += sched_pc->interval[0] *
-			tokens / sched_pc->fill_rate[0];
-	else
+	else if (tokens > sched_pc->fill_rate[0]) { 
+		delta_min[0] = sched_pc->interval[0] * 
+			(tokens / sched_pc->fill_rate[0]) - delta_min[0]; 
+		if (tokens % sched_pc->fill_rate[0]) 
+			delta_min[0] += sched_pc->interval[0]; 
+	} else 
 		delta_min[0] = sched_pc->interval[0] - delta_min[0];
 	vxd_check_range(delta_min[0], 0, INT_MAX);
 
@@ -175,10 +177,12 @@ on_hold:
 	/* next interval? */
 	if (!sched_pc->fill_rate[1])
 		delta_min[1] = HZ;
-	else if (tokens > sched_pc->fill_rate[1])
-		delta_min[1] += sched_pc->interval[1] *
-			tokens / sched_pc->fill_rate[1];
-	else
+	else if (tokens > sched_pc->fill_rate[1]) {
+		delta_min[1] = sched_pc->interval[1] *
+		        (tokens / sched_pc->fill_rate[1]) - delta_min[1];
+		if (tokens % sched_pc->fill_rate[1]) 
+			delta_min[1] += sched_pc->interval[1];
+	} else
 		delta_min[1] = sched_pc->interval[1] - delta_min[1];
 	vxd_check_range(delta_min[1], 0, INT_MAX);
 
